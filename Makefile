#
# Makefile for Smack utilities.
# Generated by hand, as the Intelligent Designer intended.
#
# Copyright (c) 2007 Casey Schaufler <casey@schaufler-ca.com>
#

CFLAGS = -Wall -Werror -g -O2

UTILS = smackload smackcipso smackexec

PAMSMACK = pam_smack.so
PAMSMACKSRC = pam_smack.c

LIBSMACK_STATIC = libsmack.a
LIBSMACK_SHARED = libsmack.so
LIBSMACKSRC = smackaccess.c setsmack.c getsmack.c smackenabled.c getsmackuser.c
LIBSMACKOBJ = $(patsubst %.c,%.o,${LIBSMACKSRC})
LIBSMACKOBJ_STATIC = $(patsubst %.o,static/%.o,${LIBSMACKOBJ})
LIBSMACKOBJ_SHARED = $(patsubst %.o,shared/%.o,${LIBSMACKOBJ})

# GENERAL RULES

default: ${LIBSMACK_STATIC} ${LIBSMACK_SHARED} ${UTILS}

clean:
	rm -rf static shared
	rm -f ${UTILS} ${LIBSMACK_STATIC} ${LIBSMACK_SHARED} ${PAMSMACK}

# UTILS

utils: ${UTILS}

%: %.c ${LIBSMACK_STATIC}
	$(CC) $(CFLAGS) -o $@ $^

# PAM MODULE

${PAMSMACK}: ${PAMSMACKSRC} ${LIBSMACK_SHARED}
	$(CC) $(CFLAGS) -fPIC -shared -o $@ $^

# STATIC LIBRARY

static:
	mkdir static

static/%.o: %.c | static
	$(CC) $(CFLAGS) -c -o $@ $^

${LIBSMACK_STATIC}: ${LIBSMACKOBJ_STATIC}
	ar cr ${LIBSMACK_STATIC} ${^}

# SHARED LIBRARY

shared:
	mkdir shared

shared/%.o: %.c | shared
	$(CC) $(CFLAGS) -c -fPIC -o $@ $^

${LIBSMACK_SHARED}: ${LIBSMACKOBJ_SHARED}
	$(CC) $(CFLAGS) -fPIC -shared -o ${LIBSMACK_SHARED} ${LIBSMACKOBJ_SHARED}


